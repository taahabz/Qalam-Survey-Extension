(function(){console.log("🟢 Qalam Survey Auto-Fill Script STARTED");function u(r){return new Promise(n=>setTimeout(n,r))}async function x(){if(!(await chrome.storage.local.get(["autoFillEnabled"])).autoFillEnabled){console.log("⏸️ Auto-fill is disabled. Skipping survey auto-fill.");return}console.log("⏳ Waiting for page to fully load..."),await u(1e3);const n=window.location.href;if(console.log("🌐 Current URL:",n),n.includes("thankyou")||n.includes("submitted")){console.log("✅ Already on a thank you/submitted page. Processing next survey..."),await b();return}const o=document.querySelector("button.o_survey_start_button, button.btn-primary");o&&o.innerText.toLowerCase().includes("start")?(console.log("🟩 Found Start Survey button. Clicking it..."),o.click(),console.log("⏳ Waiting for questions to load..."),await u(3e3)):console.log("⚠️ No Start button found or already clicked.");const l=await chrome.storage.local.get(["ratingOption","commentText","randomizeRating","ratingMin","ratingMax","randomizeComment"]),s=l.ratingOption||"first",c=l.commentText||"Good",h=l.randomizeRating||!1,y=l.ratingMin||1,w=l.ratingMax||5,k=l.randomizeComment||!1;console.log(`⚙️ Using configuration - Rating: ${s}, Comment: "${c}", Randomize: ${h}, Range: ${y}-${w}`);const m=document.querySelectorAll("tr.bg-white");console.log(`📋 Found ${m.length} matrix rows`),m.length===0&&console.warn("❌ No matrix rows found! Are you sure questions have loaded?");for(const[a,i]of Array.from(m).entries()){const e=i.querySelectorAll('input[type="radio"]');if(e.length>0){let t=0;if(s==="randomize"&&h){const g=Math.max(0,Math.min(y-1,e.length-1)),f=Math.max(0,Math.min(w-1,e.length-1)),M=Math.abs(f-g)+1;t=Math.min(g,f)+Math.floor(Math.random()*M),console.log(`🎲 Randomizing: selected ${t+1} from range ${g+1}-${f+1}`)}else switch(s){case"first":t=0;break;case"last":t=e.length-1;break;case"middle":t=Math.floor(e.length/2);break;case"second":t=Math.min(1,e.length-1);break;case"second-last":t=Math.max(0,e.length-2);break;default:t=0}e[t].checked=!0,e[t].dispatchEvent(new Event("change",{bubbles:!0})),console.log(`✅ Selected option ${t+1}/${e.length} (${s}) for row ${a+1}`)}else console.warn(`⚠️ No radio buttons found in row ${a+1}`)}const d=document.querySelector("textarea.form-control.o_survey_question_text_box");if(d){let a=c;if(k&&c.includes(",")){const i=c.split(",").map(e=>e.trim()).filter(e=>e.length>0);i.length>0&&(a=i[Math.floor(Math.random()*i.length)],console.log(`🎲 Randomly selected comment: "${a}" from ${i.length} options`))}console.log(`📝 Comment field found. Filling in "${a}"...`),d.value=a,d.dispatchEvent(new Event("input",{bubbles:!0}))}else console.warn("⚠️ No comment field found.");await u(500);const v=document.querySelector("textarea.form-control.o_survey_question_text_box");v&&v.dispatchEvent(new Event("blur",{bubbles:!0}));const p=document.querySelector('button[type="submit"], .o_survey_submit');if(p)console.log("🟢 Found Submit button. Clicking it..."),p.click();else{console.log("⚠️ Submit button not found. Trying Ctrl + Enter to submit...");const a=new KeyboardEvent("keydown",{key:"Enter",ctrlKey:!0,bubbles:!0,cancelable:!0});document.dispatchEvent(a)}setTimeout(async()=>{await b()},2e3)}async function b(){const n=(await chrome.storage.local.get(["survey_queue"])).survey_queue||[];if(n.length>0){const o=n.slice(1);await chrome.storage.local.set({survey_queue:o}),o.length>0?(console.log(`🔄 ${o.length} surveys remaining. Moving to next...`),window.location.href=o[0]):(console.log("🔙 All surveys completed. Navigating back to feedback page..."),window.location.href="https://qalam.nust.edu.pk/student/qa/feedback")}else console.log("🔙 No more surveys in queue. Navigating back to feedback page..."),window.location.href="https://qalam.nust.edu.pk/student/qa/feedback"}window.onerror=function(r,n,o,l,s){console.error("💥 ERROR:",r,"at",o+":"+l)},setTimeout(x,1e3)})();

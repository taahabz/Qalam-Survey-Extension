console.log("ğŸŸ¢ Qalam Surveys Background Script Loaded");chrome.runtime.onInstalled.addListener(async e=>{console.log("ğŸ“¦ Extension installed/updated",e);const t=await chrome.storage.local.get(["autoFillEnabled","ratingOption","commentText","randomizeRating","ratingMin","ratingMax","randomizeComment"]),o={};t.autoFillEnabled===void 0&&(o.autoFillEnabled=!1),t.ratingOption===void 0&&(o.ratingOption="first"),t.commentText===void 0&&(o.commentText="Good"),t.randomizeRating===void 0&&(o.randomizeRating=!1),t.ratingMin===void 0&&(o.ratingMin=1),t.ratingMax===void 0&&(o.ratingMax=5),t.randomizeComment===void 0&&(o.randomizeComment=!1),Object.keys(o).length>0&&(await chrome.storage.local.set(o),console.log("âœ… Default settings initialized:",o));try{e&&e.reason==="install"&&(console.log("ğŸ”” Opening post-install page"),await chrome.tabs.create({url:chrome.runtime.getURL("post-install.html")}),await chrome.storage.local.set({postInstallShown:!0}))}catch(a){console.error("Failed to open post-install page:",a)}});chrome.runtime.onStartup.addListener(async()=>{try{(await chrome.storage.local.get(["postInstallShown"])).postInstallShown||(console.log("ğŸ”” Opening post-install page on startup"),await chrome.tabs.create({url:chrome.runtime.getURL("post-install.html")}),await chrome.storage.local.set({postInstallShown:!0}))}catch(e){console.error("Failed to check/open post-install page on startup:",e)}});async function n(){try{const e=await chrome.tabs.query({url:["https://qalam.nust.edu.pk/student/qa/feedback*","https://qalam.nust.edu.pk/survey/*"]});for(const t of e)if(t.id)try{t.url?.includes("/student/qa/feedback")?(await chrome.scripting.executeScript({target:{tabId:t.id},files:["content-script-feedback.js"]}),console.log(`âœ… Injected feedback script into tab ${t.id}`)):t.url?.includes("/survey/")&&(await chrome.scripting.executeScript({target:{tabId:t.id},files:["content-script-survey.js"]}),console.log(`âœ… Injected survey script into tab ${t.id}`))}catch(o){console.log(`âš ï¸ Could not inject into tab ${t.id}:`,o)}}catch(e){console.error("Failed to inject content scripts:",e)}}chrome.runtime.onMessage.addListener((e,t,o)=>{if(console.log("ğŸ“¨ Message received:",e),e.type==="GET_STATUS")return chrome.storage.local.get(["autoFillEnabled","survey_queue"],a=>{o({autoFillEnabled:a.autoFillEnabled||!1,queueLength:(a.survey_queue||[]).length})}),!0;if(e.type==="TOGGLE_AUTOFILL")return chrome.storage.local.set({autoFillEnabled:e.enabled},async()=>{console.log(`ğŸ”„ Auto-fill ${e.enabled?"enabled":"disabled"}`),e.enabled&&(console.log("ğŸ”§ Injecting content scripts into existing tabs..."),await n()),o({success:!0})}),!0;if(e.type==="CLEAR_QUEUE")return chrome.storage.local.remove("survey_queue",()=>{console.log("ğŸ—‘ï¸ Survey queue cleared"),o({success:!0})}),!0});
